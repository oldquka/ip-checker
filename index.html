<!DOCTYPE html>
<html lang="en">
<head>
  <!-- (isti head kao gore, izostavljen zbog dužine) -->
  <!-- ... -->
</head>
<body>
  <!-- (isti body kao gore, izostavljen zbog dužine) -->
  <!-- ... -->
  <script>
    window.onload = function() {
      // MINI INFO: Browser name/version, IP type
      function detectMiniInfo(ipType) {
        let ua = navigator.userAgent;
        let browser = 'Browser';
        let version = '';
        if (ua.indexOf('Firefox') > -1) {
          browser = 'Firefox';
          version = ua.split('Firefox/')[1]?.split(' ')[0] || '';
        } else if (ua.indexOf('Edg') > -1) {
          browser = 'Edge';
          version = ua.split('Edg/')[1]?.split(' ')[0] || '';
        } else if (ua.indexOf('Chrome') > -1) {
          browser = 'Chrome';
          version = ua.split('Chrome/')[1]?.split(' ')[0] || '';
        } else if (ua.indexOf('Safari') > -1) {
          browser = 'Safari';
          version = ua.split('Version/')[1]?.split(' ')[0] || '';
        }
        let out = `Browser: ${browser} ${version ? version : ""}`;
        if (ipType) out += ` | IP type: ${ipType}`;
        document.getElementById('mini-info').textContent = out;
      }

      // IP DATA (use ipwho.is as main, fallback to ipinfo)
      let userData = {
        ip: '...',
        type: '',
        country: '', region: '', city: '', flag: '',
        isp: '', asn: '', asname: '', timezone: ''
      };

      // Make sure buttons are enabled only after data loads
      function enableRevealButtons() {
        document.querySelectorAll('.reveal-btn').forEach(btn => {
          btn.disabled = false;
          btn.classList.remove('disabled');
        });
      }

      function fetchIPData() {
        fetch('https://ipwho.is/')
          .then(resp => resp.json())
          .then(data => {
            userData.ip = data.ip || '...';
            userData.type = data.connection?.ip_version || (userData.ip.indexOf(':') > -1 ? 'IPv6' : 'IPv4');
            userData.country = data.country_code || '';
            userData.region = data.region || '';
            userData.city = data.city || '';
            userData.flag = data.flag?.img || (userData.country ? `https://flagcdn.com/24x18/${userData.country.toLowerCase()}.png` : '');
            userData.isp = data.connection?.isp || '';
            userData.asn = data.connection?.asn || '';
            userData.asname = data.connection?.org || '';
            userData.timezone = data.timezone?.id || '';
            updateUI();
            detectMiniInfo(userData.type);
            enableRevealButtons();
          })
          .catch(() => {
            // fallback ipinfo.io
            fetch('https://ipinfo.io/json')
              .then(resp => resp.json())
              .then(data => {
                userData.ip = data.ip || '...';
                userData.type = userData.ip.indexOf(':') > -1 ? 'IPv6' : 'IPv4';
                userData.country = data.country || '';
                userData.region = data.region || '';
                userData.city = data.city || '';
                userData.flag = data.country ? `https://flagcdn.com/24x18/${data.country.toLowerCase()}.png` : '';
                userData.isp = data.org ? data.org : '';
                userData.asn = (data.org||'').split(' ')[0] || '';
                userData.asname = (data.org||'').split(' ').slice(1).join(' ') || '';
                userData.timezone = data.timezone || '';
                updateUI();
                detectMiniInfo(userData.type);
                enableRevealButtons();
              });
          });
      }
      function updateUI() {
        document.getElementById('ip-address').textContent = userData.ip;
      }
      fetchIPData();

      // REVEAL BUTTONS + ANSWERS
      const answersZone = document.getElementById('reveal-answers');
      const btnMap = [
        { id: "btn-location",  label: "Location", getContent: () => {
          let parts = [];
          if (userData.city) parts.push(userData.city);
          if (userData.region && userData.region !== userData.city) parts.push(userData.region);
          if (userData.country) parts.push(userData.country);
          let iso = userData.country;
          let flag = userData.flag ? `<img class="flag" src="${userData.flag}" alt="${userData.country} flag">` : '';
          let answer = parts.join(', ');
          if (iso) answer += ` (${iso})`;
          if (!answer) answer = "Location not available.";
          answer += flag;
          return answer;
        }},
        { id: "btn-isp", label: "ISP", getContent: () => {
          let txt = userData.isp || userData.asname || '';
          if (!txt) txt = "ISP information not available.";
          return txt;
        }},
        { id: "btn-asn", label: "ASN", getContent: () => {
          let txt = userData.asn ? `ASN: <strong>${userData.asn}</strong>` : '';
          if (userData.asname) txt += txt ? ` (${userData.asname})` : userData.asname;
          if (!txt) txt = "ASN not available.";
          return txt;
        }},
        { id: "btn-tz", label: "Timezone", getContent: () => {
          let time = '';
          if (userData.timezone) {
            let now = new Date().toLocaleString("en-US", {timeZone: userData.timezone, hour12: false});
            time = `<br>Local time: <strong>${now}</strong>`;
          }
          let txt = userData.timezone ? `Timezone: <strong>${userData.timezone}</strong>${time}` : "Timezone not available.";
          return txt;
        }}
      ];
      // answers state
      let opened = [];
      btnMap.forEach((b, i) => {
        const btn = document.getElementById(b.id);
        btn.onclick = function() {
          if (this.classList.contains('disabled') || this.disabled) return;
          this.classList.add('disabled');
          this.disabled = true;
          opened.push(i);
          renderAnswers();
        }
      });
      function renderAnswers() {
        answersZone.innerHTML = '';
        opened.forEach(idx => {
          let html = `<div class="reveal-answer">${btnMap[idx].getContent()}</div>`;
          answersZone.innerHTML += html;
        });
      }

      // Accessibility: Enter/Space on buttons
      document.querySelectorAll('.reveal-btn').forEach(btn=>{
        btn.addEventListener('keydown',function(e){
          if(e.key===' '||e.key==='Enter') this.click();
        });
      });
      // Auto resize text on reveal-btn if needed
      function fitButtons() {
        document.querySelectorAll('.reveal-btn').forEach(btn=>{
          btn.style.fontSize = ""; // reset
          let parentW = btn.offsetWidth, fs = 19, orig = btn.textContent;
          btn.style.whiteSpace = "nowrap";
          // shrink font if overflowing
          while(btn.scrollWidth > parentW && fs > 11) {
            fs -= 1;
            btn.style.fontSize = fs + "px";
          }
        });
      }
      window.addEventListener('resize', fitButtons);
      setTimeout(fitButtons, 600);

      // Keyboard accessibility: focus outline
      document.querySelectorAll('button, a').forEach(el=>{
        el.addEventListener('keyup', e=>{
          if(e.key==='Tab') el.style.outline = "2px solid var(--green)";
        });
        el.addEventListener('blur', e=>{
          el.style.outline = "";
        });
      });
    };
  </script>
</body>
</html>
